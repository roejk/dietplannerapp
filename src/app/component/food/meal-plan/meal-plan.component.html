<ng-container *ngIf="appState$ | async as appState">
  <div class="container-xl mb-5">
    <ng-container [ngSwitch]="appState.dataState">
      <ng-container *ngSwitchCase="DataState.LOADING_STATE">
        <div class="col-md-12 single-note-item text-center">
          <div class="spinner-border text-info" role="status"></div>
        </div>
      </ng-container>
      <ng-container *ngSwitchCase="DataState.LOADED_STATE">
        <div class="text-align-center pt-4 pb-3">
          <mat-button-toggle-group
            name="fontStyle"
            aria-label="Font Style"
            class="mat-elevation-z8"
          >
            <ng-container *ngFor="let date of dates; let lastCall = last">
              <mat-button-toggle
                value="{{ date }}"
                [checked]="lastCall ? 'true' : null"
                (change)="filterEntriesByDate($event)"
                >{{ date | date : "dd. MMMM" }}</mat-button-toggle
              >
            </ng-container>
          </mat-button-toggle-group>
          <mat-form-field>
            <mat-label>Choose a date</mat-label>
            <input
              matInput
              [matDatepicker]="picker"
              (dateChange)="filterEntriesByDate($event)"
            />
            <mat-datepicker-toggle
              matIconSuffix
              [for]="picker"
            ></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>

        <div *ngFor="let type of this.types; let i = index">
          <ng-container *ngIf="splittedData$[i] | async as split">
            <ng-container>
              <div class="text-align-center pt-4 pb-3">
                <span class="title-text-font">{{ type }}</span>
              </div>
              <table
                mat-table
                [dataSource]="split.appData"
                class="mat-elevation-z8"
              >
                <ng-container matColumnDef="meal">
                  <th mat-header-cell *matHeaderCellDef>Meal</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.meal.name }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="date">
                  <th mat-header-cell *matHeaderCellDef>Date</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.date }}
                  </td>
                </ng-container>

                <ng-container matColumnDef="amount">
                  <th mat-header-cell *matHeaderCellDef>Amount</th>
                  <td mat-cell *matCellDef="let element">
                    {{ element.amount + " g" }}
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                  mat-row
                  *matRowDef="let row; columns: displayedColumns"
                ></tr>
              </table>
            </ng-container>
          </ng-container>
        </div>
        <ng-container *ngSwitchCase="DataState.ERROR_STATE">
          <div class="alert-danger">
            {{ appState.error }}
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
  </div>
</ng-container>
